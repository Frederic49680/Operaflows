ğŸ§© MODULE 1 â€” AUTHENTIFICATION / RÃ”LES / PERMISSIONS (Version finale validÃ©e)
ğŸ¯ Objectif du module

Assurer un accÃ¨s sÃ©curisÃ©, hiÃ©rarchisÃ© et traÃ§able Ã  lâ€™application Suivi & Planification dâ€™ActivitÃ©s,
en distinguant strictement :

les rÃ´les applicatifs (droits techniques et pÃ©rimÃ¨tres dâ€™accÃ¨s),

les profils mÃ©tiers RH (fonction rÃ©elle de la ressource dans lâ€™entreprise).

Le tout sous la supervision dâ€™un Administrateur (rÃ´le technique maÃ®tre) et dâ€™un ou plusieurs Administratifs RH / Formation / DosimÃ©trie (rÃ´les fonctionnels internes).

ğŸ§­ Principe clÃ© : RÃ´le â‰  Profil
Ã‰lÃ©ment	GÃ©rÃ© dans	Contenu	Exemple
RÃ´le applicatif	tblUsers	Droit dâ€™accÃ¨s, pÃ©rimÃ¨tre dâ€™action, autorisations sur modules	Administrateur, Planificateur, Technicien
Profil mÃ©tier RH	tblCollaborateurs	Fonction rÃ©elle, rattachement hiÃ©rarchique, compÃ©tences, contrat	Conducteur, Chef de Chantier, etc.

Le rÃ´le applicatif dÃ©finit ce que lâ€™utilisateur peut faire.

Le profil mÃ©tier dÃ©finit ce que lâ€™utilisateur est dans la structure.

Les deux sont liÃ©s via CollaborateurID, mais administrÃ©s indÃ©pendamment.

ğŸ‘¥ RÃ´les applicatifs
RÃ´le	Description	AccÃ¨s / Permissions principales	Exemple concret
Administrateur	Supervise la configuration technique, les rÃ´les et la sÃ©curitÃ©	Gestion des utilisateurs, rÃ´les, rÃ©fÃ©rentiels, logs, validations de crÃ©ation de comptes	Active ou dÃ©sactive un utilisateur, attribue les rÃ´les
Responsable dâ€™ActivitÃ©	Supervise les chargÃ©s dâ€™affaires et la cohÃ©rence opÃ©rationnelle	AccÃ¨s complet aux affaires de son pÃ©rimÃ¨tre, validation des rapports prÃ©-planif	Pilote le portefeuille dâ€™affaires dâ€™une activitÃ©
Planificateur	Valide les plannings et supervise le Gantt multi-sites	AccÃ¨s total au module planification, dÃ©tection des chevauchements, ajustements	Valide les plannings avant lancement
ChargÃ© dâ€™Affaires	GÃ¨re la vie dâ€™une affaire et ses activitÃ©s	CrÃ©ation/modif dâ€™activitÃ©s, suivi Gantt, claims	CrÃ©e une nouvelle affaire, planifie ses lots
Chef de Chantier / Encadrant	GÃ¨re les Ã©quipes terrain	Saisie du suivi quotidien, report/suspension	DÃ©clare la production journaliÃ¨re
Technicien / Ressource terrain	ExÃ©cute les activitÃ©s planifiÃ©es	Lecture sur ses activitÃ©s, report, commentaires	Consulte son planning
Administratif RH / Formation / DosimÃ©trie	GÃ¨re le personnel, les formations et la conformitÃ©	AccÃ¨s complet au module RH, formations, dosimÃ©trie	Met Ã  jour un dossier RH ou une formation validÃ©e
Consultation / Direction	Lecture seule globale	Consultation KPI, Gantt consolidÃ©	Direction / contrÃ´le interne
ğŸ§± DonnÃ©es principales (niveau fonctionnel)

tblUsers : email, rÃ´le, statut, CollaborateurID, date crÃ©ation, derniÃ¨re connexion

tblRoles : nom, description, modules autorisÃ©s

tblPermissions : mappage rÃ´le â†’ actions (read, write, validate)

tblSessions : connexions, durÃ©e, IP, logs

tblUserRequests : demandes de crÃ©ation de compte utilisateur (workflow RH/Admin)

ğŸ” FonctionnalitÃ©s clÃ©s
1. Connexion sÃ©curisÃ©e Supabase Auth

Authentification via email professionnel prenom.nom@snef.fr

Lien de validation via SendGrid

RÃ©initialisation mot de passe sÃ©curisÃ©e

Mot de passe temporaire Ã  durÃ©e limitÃ©e (48h lors dâ€™une crÃ©ation)

2. Gestion des rÃ´les et profils

Onglet â€œRÃ´le applicatifâ€ : visible et modifiable uniquement par lâ€™Administrateur

Onglet â€œProfil RHâ€ : modifiable par les Administratifs RH / Formation / DosimÃ©trie

Historisation systÃ©matique : date, auteur, champ modifiÃ©

3. Workflow dâ€™ajout dâ€™utilisateur

Un membre du service RH ou un Responsable soumet une demande de crÃ©ation via formulaire :

Nom

PrÃ©nom

Adresse mail professionnelle

Cette demande arrive automatiquement dans lâ€™interface de lâ€™Administrateur (notification â€œNouvel utilisateur Ã  validerâ€).

Lâ€™Administrateur dÃ©cide :

dâ€™accepter â†’ crÃ©ation du compte dans tblUsers avec attribution manuelle du rÃ´le et du pÃ©rimÃ¨tre (site/activitÃ©).

Envoi dâ€™un mot de passe provisoire (valable 48h) via SendGrid.

de refuser â†’ archivage de la demande avec motif.

âœ… Ce processus empÃªche tout auto-enregistrement sauvage et garantit un circuit dâ€™approbation maÃ®trisÃ©.

4. ContrÃ´le dâ€™accÃ¨s dynamique

Middleware withRole() cÃ´tÃ© Next.js pour la navigation

RLS Supabase pour la visibilitÃ© des donnÃ©es (filtrage par activitÃ©, site, affaire)

5. Audit et traÃ§abilitÃ©

Historique complet des connexions, affectations, validations et suppressions

Consultable via un panneau â€œJournal dâ€™auditâ€ rÃ©servÃ© Ã  lâ€™Administrateur

ğŸª¶ Interfaces & UX attendues

Page : Gestion des utilisateurs (Administrateur)

Tableau global avec filtres (site, rÃ´le, Ã©tat actif/inactif)

Bloc latÃ©ral â€œDemandes dâ€™accÃ¨s en attenteâ€

Boutons : âœ… Accepter / âŒ Refuser

Si acceptation â†’ popup dâ€™attribution du rÃ´le et du pÃ©rimÃ¨tre

Avertissement visuel si compte non activÃ© sous 48h

Export CSV / Audit

Page : Profil utilisateur

Onglet Profil RH (lecture seule ou modifiable selon rÃ´le RH)

Onglet RÃ´le applicatif (lecture seule sauf Administrateur)

Statut clair : Actif / Suspendu / En attente validation

Indicateur si le collaborateur a un profil RH sans rÃ´le attribuÃ© (âš ï¸ â€œNon assignÃ©â€)

âš™ï¸ Automatisations & Notifications

SendGrid :

Mail de crÃ©ation compte â†’ mot de passe provisoire 48h

Mail de refus â†’ motif de refus

Notification Admin â†’ â€œNouvelle demande dâ€™accÃ¨sâ€

Routine Supabase (cron) :

Suppression automatique des comptes non activÃ©s aprÃ¨s 48h

Suspension des comptes inactifs >90 jours

Alerte interne :

Badge rouge â€œDemandes en attenteâ€ sur lâ€™icÃ´ne Admin

Notification RH si profil modifiÃ© par un autre Administratif

ğŸ”® Ã‰volutions prÃ©vues

ğŸ” SSO Azure AD interne SNEF

ğŸ” 2FA sur rÃ´les critiques (Administrateur, Planificateur)

ğŸ§© DÃ©lÃ©gation temporaire (â€œRemplaÃ§antâ€)

ğŸ§¾ Export complet du journal dâ€™audit (CSV / PDF signÃ©)

ğŸ§  Attribution semi-automatique du rÃ´le en fonction du profil RH (IA ou rÃ¨gle logique)---
alwaysApply: true
---
