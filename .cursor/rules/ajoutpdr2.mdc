Mise Ã  jour PRD â€” Module 2.2 â€œSites & Responsables dâ€™activitÃ©â€
ğŸ”¹ Objectif

Remplace la logique simplifiÃ©e de â€œsiteâ€ et â€œresponsableâ€ actuellement intÃ©grÃ©e dans la fiche collaborateur par un rÃ©fÃ©rentiel structurÃ©, permettant :

le multi-site,

les validations hiÃ©rarchiques automatiques,

et la cohÃ©rence inter-modules (Planif, KPI, RH, Affaires).

ğŸ”¹ Nouvelles tables Ã  crÃ©er
1ï¸âƒ£ tbl_sites

RÃ©fÃ©rentiel unique de tous les sites dâ€™activitÃ©.

Champ	Type	Description
site_id	uuid (PK)	Identifiant unique
site_code	text	Code court (ex. BEL, DAM, SAV)
site_label	text	LibellÃ© complet
parent_site_id	uuid (nullable)	Site parent (optionnel)
is_active	bool	Masquage logique
created_at	timestamptz	Audit
2ï¸âƒ£ tbl_site_responsables

Association entre un site et son ou ses responsables dâ€™activitÃ©.

Champ	Type	Description
site_id	uuid (FK â†’ tbl_sites)	Site concernÃ©
collaborateur_id	uuid (FK â†’ tbl_collaborateurs)	Responsable du site
role_fonctionnel	text	"Responsable dâ€™activitÃ©", "Adjoint", "SupplÃ©ant"
date_debut	date	DÃ©but de la responsabilitÃ©
date_fin	date (nullable)	Fin prÃ©vue
is_active	bool	Statut en cours
PK	(site_id, collaborateur_id, role_fonctionnel)	

RÃ¨gle :

Un site peut avoir plusieurs responsables.

Un collaborateur peut piloter plusieurs sites.

3ï¸âƒ£ tbl_collaborateur_sites

Gestion des affectations multi-sites.

Champ	Type	Description
collaborateur_id	uuid (FK â†’ tbl_collaborateurs)	
site_id	uuid (FK â†’ tbl_sites)	
priorite	int	1 = principal, 2 = secondaire
date_debut / date_fin	date	PÃ©riode dâ€™affectation
PK	(collaborateur_id, site_id)	
ğŸ”¹ Champs Ã  modifier / supprimer dans tbl_collaborateurs
Action	Champ	Remplacement
âœ… Ajouter	site_id	FK vers tbl_sites (site principal)
âœ… Ajouter	responsable_activite_id	FK vers tbl_collaborateurs (hiÃ©rarchie directe)
âŒ Supprimer	Site (texte libre)	remplacÃ© par site_id
âŒ Supprimer	Responsable (texte libre)	remplacÃ© par responsable_activite_id
ğŸ”¹ Logique mÃ©tier mise Ã  jour

Lorsquâ€™un collaborateur est crÃ©Ã© :

on lui attribue un site principal obligatoire ;

on peut lui associer des sites secondaires via tbl_collaborateur_sites.

Le responsable dâ€™activitÃ© est dÃ©terminÃ© automatiquement :

Ã  partir du site (tbl_site_responsables),

ou manuellement sâ€™il nâ€™y en a pas encore.

Lorsquâ€™une absence est saisie :

le responsable du site concernÃ© est notifiÃ© automatiquement (email + notif interne).

si plusieurs responsables : seul celui marquÃ© comme â€œResponsable dâ€™activitÃ©â€ valide.

Les plans Gantt et KPI sont automatiquement filtrÃ©s sur les sites du rÃ´le connectÃ© (scope_site dans tbl_user_roles).

Les absences multi-sites sont ventilÃ©es selon le site actif Ã  la date concernÃ©e.

ğŸ”¹ Interfaces concernÃ©es
Page RH â†’ Collaborateurs

Colonne Site principal â†’ liste dÃ©roulante (liÃ©e Ã  tbl_sites)

Colonne Responsable dâ€™activitÃ© â†’ calculÃ©e via lien tbl_site_responsables

IcÃ´ne âš ï¸ si aucun responsable dÃ©fini pour le site

Bouton â€œChanger responsableâ€ â†’ modal affichant les responsables actifs du site

Page RH â†’ RÃ©fÃ©rentiel Sites

Liste des sites, filtres actifs/inactifs, responsable(s) en cours

Actions :

â• Ajouter site

ğŸ‘¤ GÃ©rer responsables

ğŸ—‘ï¸ DÃ©sactiver site

Page Absences

Validation routÃ©e automatiquement au responsable dâ€™activitÃ© du site du collaborateur

Filtre â€œSiteâ€ ajoutÃ© dans les vues RH

ğŸ”¹ Effets inter-modules
Module	Effet du changement
Module 0 (RÃ´les)	Le champ scope_site des rÃ´les sâ€™appuie dÃ©sormais sur tbl_sites
Module 3 (Affaires)	Chaque affaire doit rÃ©fÃ©rencer un site_id (obligatoire)
Module 4 (Planif)	Filtrage Gantt par site / responsable dâ€™activitÃ©
Module 5 (KPI)	Consolidation des indicateurs par site
Module Signature	Les visas peuvent Ãªtre filtrÃ©s par site et hiÃ©rarchie responsable
ğŸ”¹ SÃ©curitÃ© et validation

Seuls les rÃ´les Admin et Admin RH peuvent crÃ©er ou modifier les sites.

Les Responsables dâ€™activitÃ© peuvent consulter et valider les donnÃ©es RH de leur pÃ©rimÃ¨tre.

Lorsquâ€™un site est dÃ©sactivÃ© :

les collaborateurs rattachÃ©s passent en statut â€œÃ  rÃ©affecterâ€,

les planifications associÃ©es sont bloquÃ©es.

ğŸ”¹ RÃ©sumÃ© de lâ€™impact

âœ… Supprime la redondance des champs â€œsiteâ€ et â€œresponsableâ€ dans la fiche RH.
âœ… Normalise la hiÃ©rarchie RH / site / responsable.
âœ… Connecte les modules RH, Planif et KPI sur un rÃ©fÃ©rentiel unique.
âœ… Automatise la validation hiÃ©rarchique des absences et notifications.
âœ… Rend possible le multi-site propre et la supervision multi-pÃ©rimÃ¨tre.---
alwaysApply: true
---
